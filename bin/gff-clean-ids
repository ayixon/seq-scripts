#!/usr/bin/env perl
# use contig name in gene id
my $i=1;
my $digits = "%02d";
my $prev = "";
while(<>){
    if (/^##FASTA/){print; while (<>){print}; last;}
    if (/^#/){print; next};
    my ($pre) = /^(\S+)/;

    if ($pre ne $prev) { # reset counter for every contig
        $i=1;
        $prev=$pre;
    }

    my $ii = sprintf($digits, $i);
    if (/\S+\s\S+\sCDS/ && s/(\bID=)([^;]+)/$1${pre}_$ii/){
        my $name = $2;
        $i++;
        if (/\bName/) { # update name if exists and empty
            s/\bName=""/Name=$name/;
        }else{ # add name
            s/\b(ID=[^;];)/$1Name=$name/;
        }
    }
    print;
}
